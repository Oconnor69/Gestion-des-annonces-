@model Web_LW.Models.UserDashboardViewModel
@using System.Text.Json
@{
    ViewData["Title"] = "Mon Dashboard";
    var monthLabels = JsonSerializer.Serialize(Model.MonthLabels);
    var monthCounts = JsonSerializer.Serialize(Model.MonthCounts);
    var categoryLabels = JsonSerializer.Serialize(Model.CategoryLabels);
    var categoryCounts = JsonSerializer.Serialize(Model.CategoryCounts);
}

<style>
    .user-content { 
        background: rgba(255,255,255,0.95); 
        border-radius: 20px; 
        padding: 2rem; 
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
    }
    .welcome-banner {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        border-radius: 16px;
        padding: 2rem;
        color: white;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    .welcome-banner::after {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 300px;
        height: 300px;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
    }
    .quick-tiles { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; }
    .tile {
        background: white;
        border-radius: 16px;
        padding: 1.75rem;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s ease;
        box-shadow: 0 4px 20px rgba(0,0,0,0.06);
        border: 2px solid transparent;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    .tile:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 40px rgba(0,0,0,0.12);
    }
    .tile .tile-icon {
        width: 70px;
        height: 70px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin-bottom: 1rem;
    }
    .tile.create .tile-icon { background: linear-gradient(135deg, rgba(17, 153, 142, 0.2) 0%, rgba(56, 239, 125, 0.2) 100%); }
    .tile.create:hover { border-color: #11998e; }
    .tile.view .tile-icon { background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%); }
    .tile.view:hover { border-color: #667eea; }
    .tile.explore .tile-icon { background: linear-gradient(135deg, rgba(240, 147, 251, 0.2) 0%, rgba(245, 87, 108, 0.2) 100%); }
    .tile.explore:hover { border-color: #f5576c; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
    .stat-box { background: white; border-radius: 14px; padding: 1.25rem; box-shadow: 0 4px 16px rgba(0,0,0,0.06); }
    .stat-label { color: #6c757d; font-size: 0.9rem; margin-bottom: 0.4rem; }
    .chart-card { background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 16px rgba(0,0,0,0.06); height: 100%; }
    @@media (max-width: 992px) {
    }
</style>

<div class="container-fluid py-4">
        <section class="user-content">
            <div class="welcome-banner">
                <div class="position-relative" style="z-index: 1;">
                    <h1 class="fw-bold mb-2">Bienvenue @Model.UserName <i class="bi bi-hand-wave"></i></h1>
                    <p class="opacity-90 mb-0">Gerez vos annonces et decouvrez de nouvelles opportunites</p>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Total annonces</div>
                    <div class="fs-3 fw-bold">@Model.TotalAnnonces</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Actives</div>
                    <div class="fs-3 fw-bold text-success">@Model.ActiveAnnonces</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Archivees ou cloturees</div>
                    <div class="fs-3 fw-bold text-muted">@Model.InactiveAnnonces</div>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-lg-7">
                    <div class="chart-card">
                        <h6 class="fw-bold mb-2">Mes publications (6 derniers mois)</h6>
                        <canvas id="userMonthlyChart" height="160"></canvas>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="chart-card">
                        <h6 class="fw-bold mb-2">Par categorie</h6>
                        <canvas id="userCategoryChart" height="220"></canvas>
                    </div>
                </div>
            </div>

            <h5 class="fw-bold mb-4"><i class="bi bi-stars me-2"></i>Que souhaitez-vous faire ?</h5>
            <div class="quick-tiles">
                <a asp-controller="Annonces" asp-action="ChoisirCategorie" class="tile create">
                    <div class="tile-icon"><i class="bi bi-plus-circle"></i></div>
                    <h5 class="fw-bold mb-2">Creer une annonce</h5>
                    <p class="text-muted small mb-0">Publiez votre bien en quelques clics</p>
                </a>
                <a asp-controller="Annonces" asp-action="MesAnnonces" class="tile view">
                    <div class="tile-icon"><i class="bi bi-card-list"></i></div>
                    <h5 class="fw-bold mb-2">Mes annonces</h5>
                    <p class="text-muted small mb-0">Consultez et gerez vos publications</p>
                </a>
                <a asp-controller="Explorer" asp-action="Index" class="tile explore">
                    <div class="tile-icon"><i class="bi bi-compass"></i></div>
                    <h5 class="fw-bold mb-2">Explorer</h5>
                    <p class="text-muted small mb-0">Decouvrez toutes les annonces</p>
                </a>
            </div>
        </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const monthLabels = @Html.Raw(monthLabels);
    const monthCounts = @Html.Raw(monthCounts);
    const categoryLabels = @Html.Raw(categoryLabels);
    const categoryCounts = @Html.Raw(categoryCounts);
    const palette = ['#11998e', '#38ef7d', '#667eea', '#f5576c', '#f6d365', '#f093fb'];

    new Chart(document.getElementById('userMonthlyChart'), {
        type: 'line',
        data: {
            labels: monthLabels,
            datasets: [{
                label: 'Annonces creees',
                data: monthCounts,
                borderColor: '#11998e',
                backgroundColor: 'rgba(17, 153, 142, 0.18)',
                fill: true,
                tension: 0.35,
                pointRadius: 4,
                borderWidth: 3
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, ticks: { precision: 0 } },
                x: { grid: { display: false } }
            }
        }
    });

    new Chart(document.getElementById('userCategoryChart'), {
        type: 'doughnut',
        data: {
            labels: categoryLabels,
            datasets: [{
                data: categoryCounts,
                backgroundColor: palette,
                borderWidth: 1,
            }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
    });
</script>
