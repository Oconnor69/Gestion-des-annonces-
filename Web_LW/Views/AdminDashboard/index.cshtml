@model Web_LW.Models.AdminDashboardViewModel
@using System.Text.Json
@{
    ViewData["Title"] = "Admin Dashboard";
    var monthLabels = JsonSerializer.Serialize(Model.MonthLabels);
    var monthCounts = JsonSerializer.Serialize(Model.MonthCounts);
    var categoryLabels = JsonSerializer.Serialize(Model.CategoryLabels);
    var categoryCounts = JsonSerializer.Serialize(Model.CategoryCounts);
    var roleLabels = JsonSerializer.Serialize(Model.RoleLabels);
    var roleCounts = JsonSerializer.Serialize(Model.RoleCounts);
}

<link rel="stylesheet" href="~/css/admin.css" />

<div class="admin-container">
    <!-- Header moderne -->
    <div class="admin-header">
        <div class="admin-header-icon"><i class="bi bi-speedometer2"></i></div>
        <h1>Bienvenue Admin <i class="bi bi-hand-wave"></i></h1>
        <p>G�rez votre plateforme d'annonces depuis ce tableau de bord moderne et intuitif</p>
    </div>

    <!-- Statistiques -->
    <div class="stats-grid">
        <div class="stat-card users">
            <div class="stat-card-icon"><i class="bi bi-people"></i></div>
            <div class="stat-card-label">Utilisateurs</div>
            <div class="stat-card-value">@Model.TotalUsers</div>
        </div>
        <div class="stat-card categories">
            <div class="stat-card-icon"><i class="bi bi-grid-3x3-gap"></i></div>
            <div class="stat-card-label">Catégories</div>
            <div class="stat-card-value">@Model.TotalCategories</div>
        </div>
        <div class="stat-card annonces">
            <div class="stat-card-icon"><i class="bi bi-megaphone"></i></div>
            <div class="stat-card-label">Annonces</div>
            <div class="stat-card-value">@Model.TotalAnnonces</div>
        </div>
    </div>

    <!-- Graphiques -->
    <div class="row g-3 mb-4">
        <div class="col-lg-8">
            <div class="chart-card">
                <div class="chart-card-header">
                    <div>
                        <h5 class="chart-card-title">Volume d'annonces</h5>
                        <p class="chart-card-subtitle">�volution sur les 6 derniers mois</p>
                    </div>
                </div>
                <canvas id="monthlyChart" height="140"></canvas>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="chart-card">
                <div class="chart-card-header">
                    <h5 class="chart-card-title">Par cat�gorie</h5>
                </div>
                <canvas id="categoryChart" height="220"></canvas>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-lg-4">
            <div class="chart-card">
                <div class="chart-card-header">
                    <h5 class="chart-card-title">R�les utilisateurs</h5>
                </div>
                <canvas id="roleChart" height="220"></canvas>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="chart-card">
                <div class="chart-card-header">
                    <div>
                        <h5 class="chart-card-title">Vue d'ensemble</h5>
                        <p class="chart-card-subtitle">Statistiques globales de la plateforme</p>
                    </div>
                </div>
                <div class="detail-info-grid">
                    <div class="detail-info-item">
                        <div class="detail-info-label"><i class="bi bi-people"></i> Utilisateurs</div>
                        <div class="detail-info-value">@Model.TotalUsers</div>
                    </div>
                    <div class="detail-info-item">
                        <div class="detail-info-label"><i class="bi bi-grid-3x3-gap"></i> Catégories</div>
                        <div class="detail-info-value">@Model.TotalCategories</div>
                    </div>
                    <div class="detail-info-item">
                        <div class="detail-info-label"><i class="bi bi-megaphone"></i> Annonces</div>
                        <div class="detail-info-value">@Model.TotalAnnonces</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions rapides -->
    <div class="quick-actions-section">
        <h2 class="quick-actions-title"><i class="bi bi-lightning"></i> Actions rapides</h2>
        <div class="quick-actions-grid">
            <a asp-controller="Utilisateurs" asp-action="Index" class="action-card action-card-primary">
                <span class="action-card-icon"><i class="bi bi-people"></i></span>
                <span class="action-card-text">Gérer les utilisateurs</span>
            </a>
            <a asp-controller="Categories" asp-action="Index" class="action-card action-card-secondary">
                <span class="action-card-icon"><i class="bi bi-grid-3x3-gap"></i></span>
                <span class="action-card-text">Gérer les catégories</span>
            </a>
            <a asp-controller="AdminAnnonces" asp-action="Index" class="action-card action-card-tertiary">
                <span class="action-card-icon"><i class="bi bi-megaphone"></i></span>
                <span class="action-card-text">G�rer les annonces</span>
            </a>
        </div>
    </div>

    <!-- Table des annonces -->
    <div class="table-section">
        <div class="table-section-header">
            <div>
                <h2 class="table-section-title">Derni�res annonces</h2>
                <p class="table-section-subtitle">Vue d'ensemble des annonces r�centes sur la plateforme</p>
            </div>
            @if (TempData["AdminMessage"] != null)
            {
                <span class="status-badge status-badge-active">@TempData["AdminMessage"]</span>
            }
        </div>
        <div class="table-responsive">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Titre</th>
                        <th>Utilisateur</th>
                        <th>Cat�gorie</th>
                        <th>Date</th>
                        <th>Statut</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                @if (Model.Annonces.Any())
                {
                    foreach (var a in Model.Annonces)
                    {
                        <tr>
                            <td><strong>@a.Id</strong></td>
                            <td><strong>@a.Titre</strong></td>
                            <td>@a.Utilisateur</td>
                            <td>@a.Categorie</td>
                            <td>@a.DatePublication.ToString("dd/MM/yyyy")</td>
                            <td>
                                @if (a.Statut == "Active")
                                {
                                    <span class="status-badge status-badge-active">@a.Statut</span>
                                }
                                else
                                {
                                    <span class="status-badge status-badge-inactive">@a.Statut</span>
                                }
                            </td>
                            <td class="text-end">
                                <a asp-controller="AdminAnnonces" asp-action="Details" asp-route-id="@a.Id" class="btn-modern btn-modern-secondary btn-modern-sm me-1">
                                    <i class="bi bi-eye"></i> Voir
                                </a>
                                <form asp-action="DeleteAnnonce" method="post" class="d-inline" onsubmit="return confirm('Supprimer cette annonce ?');">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@a.Id" />
                                    <button class="btn-modern btn-modern-danger btn-modern-sm"><i class="bi bi-trash"></i> Supprimer</button>
                                </form>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-state-icon"><i class="bi bi-inbox"></i></div>
                                <p class="empty-state-text">Aucune annonce pour le moment</p>
                            </div>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const monthLabels = @Html.Raw(monthLabels);
    const monthCounts = @Html.Raw(monthCounts);
    const categoryLabels = @Html.Raw(categoryLabels);
    const categoryCounts = @Html.Raw(categoryCounts);
    const roleLabels = @Html.Raw(roleLabels);
    const roleCounts = @Html.Raw(roleCounts);

    const palette = ['#667eea', '#764ba2', '#11998e', '#38ef7d', '#f093fb', '#f5576c', '#f6d365', '#fda085'];

    new Chart(document.getElementById('monthlyChart'), {
        type: 'line',
        data: {
            labels: monthLabels,
            datasets: [{
                label: "Annonces",
                data: monthCounts,
                tension: 0.35,
                fill: true,
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.18)',
                pointBackgroundColor: '#667eea',
                pointRadius: 4,
                borderWidth: 3
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, ticks: { precision: 0 } },
                x: { grid: { display: false } }
            }
        }
    });

    new Chart(document.getElementById('categoryChart'), {
        type: 'doughnut',
        data: {
            labels: categoryLabels,
            datasets: [{
                data: categoryCounts,
                backgroundColor: palette,
                borderWidth: 1,
            }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
    });

    new Chart(document.getElementById('roleChart'), {
        type: 'bar',
        data: {
            labels: roleLabels,
            datasets: [{
                label: 'Utilisateurs',
                data: roleCounts,
                backgroundColor: ['#667eea', '#764ba2', '#38ef7d'],
                borderRadius: 6,
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, ticks: { precision: 0 } },
                x: { grid: { display: false } }
            }
        }
    });
</script>
