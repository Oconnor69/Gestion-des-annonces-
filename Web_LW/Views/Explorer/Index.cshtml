@model Web_LW.Models.AnnonceExplorerViewModel
@{
    ViewData["Title"] = "Explorer les annonces";
}

<div class="container py-5">
    <div class="text-center mb-5 animate-fade-in">
        <h1 class="display-5 fw-bold mb-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            Explorez nos annonces
        </h1>
        <p class="lead text-muted">Decouvrez les meilleures offres pres de chez vous</p>
    </div>

    <div class="card mb-5" style="background: rgba(255,255,255,0.9); backdrop-filter: blur(20px);">
        <div class="card-body p-4">
            <h5 class="mb-4 fw-bold"><span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Filtres de recherche</span></h5>
            <form asp-action="Index" method="get">
                <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                        <label class="form-label">Recherche</label>
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0"><span>üîç</span></span>
                            <input name="Search" value="@Model.Search" class="form-control border-start-0" placeholder="Titre ou description..." />
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <label class="form-label">Categorie</label>
                        <select name="CategorieId" class="form-select">
                            <option value="">Toutes</option>
                            @foreach (var cat in Model.Categories)
                            {
                                <option value="@cat.Id" selected="@(Model.CategorieId == cat.Id)">@cat.Nom</option>
                            }
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <label class="form-label">Ville</label>
                        <select name="Ville" class="form-select">
                            <option value="">Toutes</option>
                            @{ var villes = new[] { "Casablanca", "Rabat", "Marrakech", "Fes", "Tanger", "Agadir", "Meknes", "Oujda", "Kenitra", "Tetouan", "Nador", "Safi", "El Jadida", "Mohammedia", "Beni Mellal", "Settat", "Khouribga", "Errachidia", "Laayoune", "Dakhla" }; }
                            @foreach (var v in villes)
                            {
                                <option value="@v" selected="@(string.Equals(Model.Ville, v, StringComparison.OrdinalIgnoreCase))">@v</option>
                            }
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <label class="form-label">Prix min</label>
                        <input name="PrixMin" value="@(Model.PrixMin?.ToString())" class="form-control" type="number" step="0.01" min="0" placeholder="0" />
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <label class="form-label">Prix max</label>
                        <input name="PrixMax" value="@(Model.PrixMax?.ToString())" class="form-control" type="number" step="0.01" min="0" placeholder="999999" />
                    </div>
                </div>
                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary px-4">
                        <span>üîé</span> Rechercher
                    </button>
                    <a asp-action="Index" class="btn btn-outline-secondary">
                        <span>‚Üª</span> Reinitialiser
                    </a>
                </div>
            </form>
        </div>
    </div>

    @if (Model.Annonces == null || !Model.Annonces.Any())
    {
        <div class="text-center py-5">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üì≠</div>
            <h4 class="text-muted">Aucune annonce trouvee</h4>
            <p class="text-muted">Essayez de modifier vos criteres de recherche</p>
        </div>
    }
    else
    {
        <div class="row g-4">
            @{ var delay = 0; }
            @foreach (var item in Model.Annonces)
            {
                var photoUrl = item.Photos != null && item.Photos.Any() ? item.Photos.First().Url : string.Empty;
                <div class="col-xl-4 col-lg-4 col-md-6 animate-fade-in" style="animation-delay: @(delay)ms">
                    <div class="card h-100 annonce-card">
                        <div class="card-img-wrapper" style="height: 220px; overflow: hidden; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
                            @if (!string.IsNullOrEmpty(photoUrl))
                            {
                                <img src="@photoUrl" alt="@item.Titre" class="w-100 h-100" style="object-fit: cover;" />
                            }
                            else
                            {
                                <div class="d-flex flex-column align-items-center justify-content-center h-100 text-muted">
                                    <span style="font-size: 3rem;">üì∑</span>
                                    <span class="mt-2">Pas de photo</span>
                                </div>
                            }
                        </div>
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0 text-truncate" style="max-width: 70%;" title="@item.Titre">@item.Titre</h5>
                                @if (!string.Equals(item.Statut, "Vendue", StringComparison.OrdinalIgnoreCase) && !string.Equals(item.Statut, "Louee", StringComparison.OrdinalIgnoreCase))
                                {
                                    <span class="badge bg-success">@item.Statut</span>
                                }
                            </div>
                            <div class="price-tag mb-3">@item.Prix.ToString("N0") DH</div>
                            <div class="mb-3">
                                <div class="d-flex align-items-center text-muted mb-1">
                                    <span class="me-2">üè∑Ô∏è</span> @item.Categorie?.Nom
                                </div>
                                <div class="d-flex align-items-center text-muted mb-1">
                                    <span class="me-2">üìç</span> @item.Ville
                                </div>
                                <div class="d-flex align-items-center text-muted">
                                    <span class="me-2">üìÖ</span> @item.DatePublication.ToString("dd/MM/yyyy")
                                </div>
                            </div>
                            <div class="border-top pt-3">
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 36px; height: 36px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: bold;">
                                        @(item.Utilisateur?.Nom?.Substring(0, 1).ToUpper() ?? "?")
                                    </div>
                                    <div>
                                        <div class="fw-semibold small">@(item.Utilisateur?.Nom ?? "Inconnu")</div>
                                        <div class="text-muted" style="font-size: 0.75rem;">@(string.IsNullOrWhiteSpace(item.Utilisateur?.Telephone) ? "Tel. non fourni" : item.Utilisateur.Telephone)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent p-3">
                            <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-primary w-100">
                                <span>üëÅÔ∏è</span> Voir les details
                            </a>
                        </div>
                    </div>
                </div>
                delay += 100;
            }
        </div>
    }
</div>
