<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - REkLAM</title>
    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Web_LW.styles.css" asp-append-version="true" />
</head>
<body>
@{
    var controller = ViewContext.RouteData.Values["controller"]?.ToString() ?? string.Empty;
    var action = ViewContext.RouteData.Values["action"]?.ToString() ?? string.Empty;
    var role = Context.Session.GetString("Role");
    var userId = Context.Session.GetString("UserId");
    bool isConnected = !string.IsNullOrEmpty(userId);
    bool isAuthPage = controller.Equals("Auth", StringComparison.OrdinalIgnoreCase);
    bool showSidebar = !string.IsNullOrEmpty(role) && !controller.Equals("Explorer", StringComparison.OrdinalIgnoreCase) && !isAuthPage;
    bool isAdmin = string.Equals(role, "Admin", StringComparison.OrdinalIgnoreCase);
}

    <div class="app-shell @(showSidebar ? string.Empty : "no-sidebar")">
        @if (showSidebar)
        {
            <aside class="app-sidebar @(isAdmin ? "admin" : "user")">
                <div class="brand">@(isAdmin ? "<i class='bi bi-shield-fill-check'></i> Admin Panel" : "<i class='bi bi-person-circle'></i> Mon Espace")</div>
                <ul class="menu">
                    @if (isAdmin)
                    {
                        <li><a asp-controller="AdminDashboard" asp-action="Index" class="@(controller == "AdminDashboard" ? "active" : string.Empty)"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
                        <li><a asp-controller="Utilisateurs" asp-action="Index" class="@(controller == "Utilisateurs" ? "active" : string.Empty)"><i class="bi bi-people-fill"></i> Utilisateurs</a></li>
                        <li><a asp-controller="Categories" asp-action="Index" class="@(controller == "Categories" ? "active" : string.Empty)"><i class="bi bi-grid-3x3-gap-fill"></i> Categories</a></li>
                        <li><a asp-controller="AdminAnnonces" asp-action="Index" class="@(controller == "AdminAnnonces" ? "active" : string.Empty)"><i class="bi bi-megaphone-fill"></i> Annonces</a></li>
                        <li><a asp-controller="Explorer" asp-action="Index"><i class="bi bi-compass-fill"></i> Explorer</a></li>
                    }
                    else
                    {
                        <li><a asp-controller="UserDashboard" asp-action="Index" class="@(controller == "UserDashboard" ? "active" : string.Empty)"><i class="bi bi-house-door-fill"></i> Dashboard</a></li>
                        <li><a asp-controller="Annonces" asp-action="MesAnnonces" class="@(controller == "Annonces" ? "active" : string.Empty)"><i class="bi bi-card-list"></i> Mes annonces</a></li>
                        <li><a asp-controller="Annonces" asp-action="ChoisirCategorie"><i class="bi bi-plus-circle-fill"></i> Creer annonce</a></li>
                        <li><a asp-controller="Explorer" asp-action="Index"><i class="bi bi-compass-fill"></i> Explorer</a></li>
                    }
                </ul>
                <div class="sidebar-footer">
                    <a asp-controller="Auth" asp-action="Logout" class="logout"><i class="bi bi-box-arrow-right me-2"></i> Deconnexion</a>
                </div>
            </aside>
        }

        <div class="app-main">
            @if (!isAuthPage)
            {
                <header class="topbar">
                    <div class="brand-inline"><a asp-controller="Home" asp-action="Index">REkLAM</a></div>
                    <div class="topbar-links">
                        <a asp-controller="Explorer" asp-action="Index"><i class="bi bi-compass me-1"></i>Explorer</a>
                        @if (isConnected)
                        {
                            <a asp-controller="Annonces" asp-action="ChoisirCategorie"><i class="bi bi-plus-circle me-1"></i>Créer une annonce</a>
                            <a asp-controller="Auth" asp-action="Logout" class="btn-logout"><i class="bi bi-box-arrow-right me-1"></i>Déconnexion</a>
                        }
                        else
                        {
                            <a asp-controller="Auth" asp-action="Login" class="btn-login-top"><i class="bi bi-box-arrow-in-right me-1"></i>Se connecter</a>
                        }
                    </div>
                </header>
            }
            <main role="main" class="app-content">
                @RenderBody()
            </main>
            @if (!isAuthPage)
            {
                <footer class="app-footer">
                    &copy; 2025 - REkLAM - Plateforme de petites annonces
                </footer>
            }
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)

    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
        .app-shell { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; background: #f4f6fb; }
        .app-shell.no-sidebar { grid-template-columns: 1fr; }
        .app-sidebar { padding: 1.75rem 1.25rem; color: #fff; display: flex; flex-direction: column; gap: 1rem; }
        .app-sidebar.admin { background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }
        .app-sidebar.user { background: linear-gradient(180deg, #0f0c29 0%, #302b63 50%, #24243e 100%); }
        .app-sidebar .brand { font-size: 1.25rem; font-weight: 800; margin-bottom: 1rem; }
        .app-sidebar .menu { list-style: none; padding: 0; margin: 0; }
        .app-sidebar .menu li { margin-bottom: 0.35rem; }
        .app-sidebar .menu a { color: rgba(255,255,255,0.8); text-decoration: none; padding: 0.75rem 0.9rem; border-radius: 12px; display: flex; align-items: center; gap: 0.65rem; transition: all 0.2s ease; }
        .app-sidebar .menu a:hover, .app-sidebar .menu a.active { background: rgba(255,255,255,0.12); color: #fff; transform: translateX(4px); }
        .app-sidebar .icon { width: 34px; height: 34px; display: inline-flex; align-items: center; justify-content: center; border-radius: 10px; background: rgba(255,255,255,0.12); }
        .sidebar-footer { margin-top: auto; border-top: 1px solid rgba(255,255,255,0.15); padding-top: 1rem; }
        .logout { color: rgba(255,255,255,0.85); text-decoration: none; display: inline-flex; align-items: center; gap: 0.4rem; }
        .logout:hover { color: #fff; }
        .app-main { background: #f4f6fb; display: flex; flex-direction: column; min-height: 100vh; }
        .topbar { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.5rem; background: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
        .brand-inline a { text-decoration: none; font-weight: 700; color: #1f2937; font-size: 1.3rem; }
        .topbar-links { display: flex; align-items: center; gap: 0.5rem; }
        .topbar-links a { padding: 0.5rem 1rem; color: #4b5563; text-decoration: none; border-radius: 8px; transition: all 0.2s ease; display: inline-flex; align-items: center; }
        .topbar-links a:hover { color: #111827; background: #f3f4f6; }
        .btn-login-top { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white !important; font-weight: 600; padding: 0.6rem 1.2rem !important; }
        .btn-login-top:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .btn-logout { color: #dc2626 !important; font-weight: 600; }
        .btn-logout:hover { background: #fee2e2 !important; }
        .app-content { flex: 1; padding: 1.5rem; }
        .app-footer { padding: 1rem 1.5rem; color: #6b7280; text-align: center; background: white; border-top: 1px solid #e5e7eb; }
        @@media (max-width: 992px) {
            .app-shell { grid-template-columns: 1fr; }
            .app-sidebar { display: none; }
            .app-main { min-height: 100vh; }
            .topbar-links { flex-wrap: wrap; }
        }
    </style>
</body>
</html>
